run on terminal to ensure teh code takes the path for libs installed in the venv
export PATH="/Users/amanmehra/Desktop/ads_project/virality/Backend/.venv/bin:$PATH"


Perfect âœ… â€” hereâ€™s your **finalized team-wide architecture note** complete with a visual diagram and ready to drop into your project docs or Notion â€œBackend Setupâ€ section:

---

# ğŸ§­ Unified Ads Integration Backend â€” Team Design Blueprint

### **Goal**

Weâ€™re building a backend that lets a single user:

* Sign up or log in once.
* Connect **multiple ad platforms** (Google Ads, Meta Ads, Shopify, etc.) through OAuth.
* View and sync their campaigns across platforms via one dashboard.

The architecture must be:
âœ… Modularâ€ƒâœ… Secureâ€ƒâœ… Extensibleâ€ƒâœ… Easy to maintain

---

## ğŸ§± Database Structure Overview

### **1. `users` Collection**

Stores **only user identity + OAuth credentials** (no business data).

```json
{
  "_id": "user_12345",
  "email": "aman@example.com",
  "password_hash": "bcrypt$2a$...",
  "oauth": {
    "google": {
      "access_token": "ya29...",
      "refresh_token": "1//0g123...",
      "expiry": "2025-10-13T07:00:00Z"
    },
    "meta": {
      "access_token": "EAA12345...",
      "expires_in": 5184000
    },
    "shopify": null
  },
  "created_at": "2025-10-12T18:00:00Z"
}
```

ğŸ“Œ **Purpose:**
Authenticate users, store tokens per platform, and track connected integrations.

---

### **2. Campaign Collections (Data Layer)**

Each ad platform has its own collection:

* `google_campaigns`
* `meta_campaigns`
* `shopify_campaigns`

#### Example â€” Google Campaigns

```json
{
  "_id": "ad_001",
  "user_id": "user_12345",
  "account_id": "9554344066",
  "campaign_id": "789456123",
  "name": "Search Campaign Q4",
  "status": "ENABLED",
  "budget": 1500,
  "clicks": 123,
  "impressions": 5400,
  "last_synced": "2025-10-12T22:00:00Z"
}
```

ğŸ“Œ **Purpose:**
Store fetched data from APIs (campaigns, ads, analytics) linked via `user_id`.

---

## âš™ï¸ Folder Structure Convention

```
Backend/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ google_controller.py
â”‚   â”‚   â”œâ”€â”€ meta_controller.py
â”‚   â”‚   â””â”€â”€ shopify_controller.py
â”‚   â”‚
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ user_repository.py
â”‚   â”‚   â”œâ”€â”€ google_campaigns_repo.py
â”‚   â”‚   â”œâ”€â”€ meta_campaigns_repo.py
â”‚   â”‚   â””â”€â”€ shopify_repo.py
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.py
â”‚       â”œâ”€â”€ encryption.py
â”‚       â””â”€â”€ token_refresh.py
â”‚
â””â”€â”€ main.py
```

---

## ğŸ” Design Principles

| Principle                  | Why It Matters                                             |
| -------------------------- | ---------------------------------------------------------- |
| **Separation of Concerns** | Tokens and campaigns live in separate collections.         |
| **Scalability**            | Each platformâ€™s data scales independently.                 |
| **Security**               | Passwords hashed (bcrypt); tokens encrypted before saving. |
| **Extensibility**          | Adding new APIs = add one controller + one repo file.      |
| **Maintainability**        | Controller-based modular layout.                           |
| **Future-Proof**           | Supports token refresh jobs + new integrations later.      |

---

## ğŸ§© Architecture Diagram

```
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚         Frontend         â”‚
             â”‚  React + Vite Dashboard  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   FastAPI App  â”‚
                 â”‚ (Controllers)  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚     â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Controller â”‚             â”‚  Meta Controller  â”‚
â”‚ /google/login     â”‚             â”‚ /meta/login       â”‚
â”‚ /google/callback  â”‚             â”‚ /meta/callback    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ google_campaigns â”‚              â”‚ meta_campaigns   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚         users DB         â”‚
             â”‚ (email, password, oauth) â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Development Guidelines

1. **When building controllers:**

   * Never store campaign data in the `users` collection.
   * Always use `user_id` as the link key.
2. **When adding a new platform (e.g. LinkedIn Ads):**

   * Create `linkedin_controller.py` and `linkedin_repo.py`.
   * Add a new `oauth.linkedin` field under the user model.
   * Maintain similar flow as Google/Meta.
3. **When syncing data:**

   * Use background tasks or scheduler to refresh tokens periodically.
   * Keep campaign sync logic separate from login logic.

---

## âœ… TL;DR

* **Users = Credentials only**
* **Platform collections = Campaign data**
* **Everything connected by `user_id`**
* **Same flow for Google, Meta, Shopify, etc.**

---

Would you like me to give a short **Mongo schema + sample helper functions** (like `save_or_update_user_token()`, `get_user_by_id()`, and `save_campaigns()`)?
Thatâ€™ll make your database layer instantly usable for both your and your teammateâ€™s controllers.
